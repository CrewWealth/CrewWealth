<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - CrewWealth</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap">
    <style>
        :root {
            --color-primary: #208089;
            --color-primary-hover: #1a6670;
            --color-accent: #32b8c6;
            --color-background: #fcfcf9;
            --color-surface: #ffffff;
            --color-text: #134252;
            --color-text-secondary: #626c71;
            --color-border: #e8e8e0;
            --color-success: #22c55e;
            --color-danger: #ef4444;
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-2xl: 48px;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--color-background);
            color: var(--color-text);
            line-height: 1.6;
        }

        .layout {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: var(--color-text);
            color: white;
            padding: var(--spacing-lg);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            margin-bottom: var(--spacing-xl);
        }

        .sidebar-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
        }

        .sidebar-subtitle {
            font-size: 13px;
            opacity: 0.7;
        }

        .sidebar .menu {
            flex: 1;
        }

        .sidebar .menu a {
            color: white;
            text-decoration: none;
            padding: var(--spacing-md);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-xs);
            transition: all 0.2s;
        }

        .sidebar .menu a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--color-accent);
        }

        .sidebar .menu a.active {
            background: rgba(255, 255, 255, 0.15);
            color: var(--color-accent);
        }

        .logout-btn {
            margin-top: auto;
            padding: var(--spacing-md);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-sm);
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Main Content */
        .main {
            flex: 1;
            padding: var(--spacing-2xl);
            overflow-y: auto;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
            color: white;
            padding: var(--spacing-2xl);
            border-radius: var(--radius-xl);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-lg);
        }

        .hero-greeting {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: var(--spacing-xs);
        }

        .hero-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: var(--spacing-lg);
        }

        /* Section Title */
        .section-title {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-lg);
        }

        /* Dashboard Widgets */
        .dashboard-widgets {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-2xl);
        }

        .widget-card {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            border: 2px solid var(--color-border);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
        }

        .widget-card:hover {
            box-shadow: var(--shadow-md);
        }

        .widget-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
        }

        .widget-icon {
            font-size: 24px;
        }

        .widget-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--color-text);
        }

        .widget-content {
            min-height: 120px;
        }

        .widget-footer {
            margin-top: var(--spacing-lg);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--color-border);
        }

        .widget-link {
            color: var(--color-primary);
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            transition: color 0.2s;
        }

        .widget-link:hover {
            color: var(--color-primary-hover);
        }

        /* Month Overview Widget */
        .budget-stat {
            margin-bottom: var(--spacing-md);
        }

        .budget-stat-label {
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-xs);
        }

        .budget-stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--color-text);
        }

        .budget-progress {
            margin-top: var(--spacing-md);
        }

        .progress-bar {
            height: 8px;
            background: var(--color-border);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: var(--spacing-xs);
        }

        .progress-fill {
            height: 100%;
            background: var(--color-success);
            border-radius: 4px;
            transition: width 0.3s, background 0.3s;
        }

        .progress-fill.over-budget {
            background: var(--color-danger);
        }

        .progress-label {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        /* Transaction Item */
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--color-border);
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 2px;
        }

        .transaction-meta {
            font-size: 12px;
            color: var(--color-text-secondary);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .transaction-amount {
            font-size: 14px;
            font-weight: 700;
        }

        .transaction-amount.expense {
            color: var(--color-danger);
        }

        .transaction-amount.income {
            color: var(--color-success);
        }

        /* Goal Item */
        .goal-item {
            margin-bottom: var(--spacing-lg);
        }

        .goal-item:last-child {
            margin-bottom: 0;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xs);
        }

        .goal-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .goal-percentage {
            font-size: 12px;
            font-weight: 600;
            color: var(--color-primary);
        }

        .goal-amounts {
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-xs);
        }

        /* Bill Item */
        .bill-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--color-border);
        }

        .bill-item:last-child {
            border-bottom: none;
        }

        .bill-info {
            flex: 1;
        }

        .bill-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 2px;
        }

        .bill-due {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .bill-due.upcoming {
            color: var(--color-warning);
            font-weight: 600;
        }

        .bill-due.overdue {
            color: var(--color-danger);
            font-weight: 600;
        }

        .bill-amount {
            font-size: 14px;
            font-weight: 700;
            color: var(--color-text);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--color-text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            opacity: 0.5;
            margin-bottom: var(--spacing-md);
        }

        .empty-state-text {
            font-size: 14px;
            margin-bottom: var(--spacing-md);
        }

        .empty-state-cta {
            display: inline-block;
            padding: var(--spacing-sm) var(--spacing-lg);
            background: var(--color-primary);
            color: white;
            text-decoration: none;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }

        .empty-state-cta:hover {
            background: var(--color-primary-hover);
        }

        /* Net Worth Card */
        .net-worth-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            text-align: center;
            margin-top: var(--spacing-lg);
        }

        .net-worth-label {
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.9;
            margin-bottom: var(--spacing-xs);
        }

        .net-worth-amount {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
        }

        .net-worth-breakdown {
            font-size: 14px;
            opacity: 0.9;
        }

        .net-worth-breakdown .divider {
            margin: 0 var(--spacing-sm);
        }

        /* Calculator Grid */
        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-2xl);
        }

        .calc-card {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            border: 2px solid var(--color-border);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .calc-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--color-primary);
        }

        .calc-icon {
            font-size: 32px;
            margin-bottom: var(--spacing-sm);
        }

        .calc-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        .calc-description {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-lg);
        }

        .modal-content {
            background: var(--color-surface);
            border-radius: var(--radius-xl);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-large {
            max-width: 600px;
        }

        .modal-header {
            font-size: 20px;
            font-weight: 700;
            padding: var(--spacing-xl);
            border-bottom: 2px solid var(--color-border);
            color: var(--color-text);
        }

        .modal form {
            padding: var(--spacing-xl);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            color: var(--color-text);
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-family: 'Poppins', sans-serif;
            color: var(--color-text);
            transition: border-color 0.2s;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
        }

        .calculator-results {
            background: rgba(32, 128, 137, 0.05);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin: var(--spacing-lg) 0;
        }

        .calculator-results h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--color-text);
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--color-border);
        }

        .result-row.highlight {
            background: rgba(32, 128, 137, 0.1);
            padding: var(--spacing-md);
            border-radius: var(--radius-sm);
            border-bottom: none;
            margin-top: var(--spacing-sm);
            font-size: 16px;
        }

        .result-row strong {
            color: var(--color-primary);
            font-weight: 600;
        }

        .modal-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: flex-end;
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--color-border);
        }

        .btn {
            padding: var(--spacing-md) var(--spacing-xl);
            border: none;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Poppins', sans-serif;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: var(--color-border);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background: var(--color-text-secondary);
            color: white;
        }

        /* Calculator Modal Styles */
        .calculator-body {
            padding: var(--spacing-lg);
        }

        .calculator-results {
            margin-top: var(--spacing-lg);
            padding: var(--spacing-lg);
            background: rgba(32, 128, 137, 0.05);
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border);
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--color-border);
        }

        .result-row:last-child {
            border-bottom: none;
        }

        .result-row strong {
            font-size: 16px;
            color: var(--color-primary);
        }

        .text-success {
            color: var(--color-success) !important;
        }

        .text-danger {
            color: var(--color-danger) !important;
        }

        .text-warning {
            color: #f59e0b !important;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--color-text-secondary);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            float: right;
        }

        .modal-close:hover {
            color: var(--color-text);
        }

        .modal-header {
            font-size: 20px;
            font-weight: 700;
            padding: var(--spacing-xl);
            border-bottom: 2px solid var(--color-border);
            color: var(--color-text);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                padding: var(--spacing-md);
            }

            .sidebar .menu {
                display: flex;
                flex-wrap: wrap;
                gap: var(--spacing-sm);
            }

            .sidebar .menu a {
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }

            .main {
                padding: var(--spacing-lg);
            }

            .hero {
                padding: var(--spacing-lg);
            }

            .hero-title {
                font-size: 22px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
            
            .calculator-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .dashboard-widgets {
                grid-template-columns: 1fr;
            }

            .modal-content {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">üí∞ CrewWealth</div>
                <div class="sidebar-subtitle">Financial Management</div>
            </div>

            <nav class="menu">
                <a href="/" class="active">üè† Dashboard</a>
                <a href="/budget">üí≥ Budget & Accounts</a>
                <a href="/goals">üéØ Goals</a>
                <a href="/reports">üìä Reports</a>
                <a href="/settings">‚öôÔ∏è Settings</a>
            </nav>

            <button class="logout-btn" id="logoutBtn">
                üö™ Logout
            </button>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <!-- Hero Section -->
            <div class="hero">
                <div class="hero-greeting" id="heroGreeting">Welcome back üëã</div>
                <h1 class="hero-title">Your Financial Overview</h1>
                
                <div class="net-worth-card">
                    <div class="net-worth-label">Net Worth</div>
                    <div class="net-worth-amount" id="netWorthAmount">‚Ç¨0.00</div>
                    <div class="net-worth-breakdown">
                        <span id="savingsAmount">‚Ç¨0 Savings</span>
                        <span class="divider">‚Ä¢</span>
                        <span id="toBudgetAmount">‚Ç¨0 Available</span>
                    </div>
                </div>
            </div>

            <!-- Quick Calculators Section - Hidden until implemented -->
            <div class="section-title" style="display: none;">Quick Calculators</div>
            <div class="calculator-grid" style="display: none;">
                <div class="calc-card" onclick="openIncomeCalculator()">
                    <div class="calc-icon">üí∞</div>
                    <div class="calc-title">Income</div>
                    <div class="calc-description">Calculate contract earnings</div>
                </div>

                <div class="calc-card" onclick="openTaxCalculator()">
                    <div class="calc-icon">üíº</div>
                    <div class="calc-title">Tax</div>
                    <div class="calc-description">Estimate your taxes</div>
                </div>

                <div class="calc-card" onclick="openFamilyCalculator()">
                    <div class="calc-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                    <div class="calc-title">Family</div>
                    <div class="calc-description">Support calculator</div>
                </div>

                <div class="calc-card" onclick="openSavingsCalculator()">
                    <div class="calc-icon">üè¶</div>
                    <div class="calc-title">Savings</div>
                    <div class="calc-description">Plan your savings</div>
                </div>

                <div class="calc-card" onclick="openInvestmentCalculator()">
                    <div class="calc-icon">üìà</div>
                    <div class="calc-title">Investment</div>
                    <div class="calc-description">Returns calculator</div>
                </div>
            </div>

            <!-- Dashboard Widgets -->
            <div class="section-title">Financial Overview</div>
            <div class="dashboard-widgets">
                <!-- Month Overview Widget -->
                <div class="widget-card">
                    <div class="widget-header">
                        <span class="widget-icon">üìä</span>
                        <h3 class="widget-title">Month Overview</h3>
                    </div>
                    <div class="widget-content" id="monthOverviewContent">
                        <div class="budget-stat">
                            <div class="budget-stat-label">Total Budgeted</div>
                            <div class="budget-stat-value" id="totalBudgeted">‚Ç¨0.00</div>
                        </div>
                        <div class="budget-stat">
                            <div class="budget-stat-label">Total Spent</div>
                            <div class="budget-stat-value" id="totalSpent">‚Ç¨0.00</div>
                        </div>
                        <div class="budget-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="budgetProgressBar" style="width: 0%"></div>
                            </div>
                            <div class="progress-label" id="budgetProgressLabel">0% of budget used</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Transactions Widget -->
                <div class="widget-card">
                    <div class="widget-header">
                        <span class="widget-icon">üí≥</span>
                        <h3 class="widget-title">Recent Transactions</h3>
                    </div>
                    <div class="widget-content" id="recentTransactionsContent">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìù</div>
                            <div class="empty-state-text">No transactions yet</div>
                        </div>
                    </div>
                    <div class="widget-footer">
                        <a href="/budget" class="widget-link">View All ‚Üí</a>
                    </div>
                </div>

                <!-- Savings Goals Widget -->
                <div class="widget-card">
                    <div class="widget-header">
                        <span class="widget-icon">üéØ</span>
                        <h3 class="widget-title">Savings Goals</h3>
                    </div>
                    <div class="widget-content" id="goalsProgressContent">
                        <div class="empty-state">
                            <div class="empty-state-icon">üéØ</div>
                            <div class="empty-state-text">No active goals</div>
                            <a href="/goals" class="empty-state-cta">Create your first goal</a>
                        </div>
                    </div>
                    <div class="widget-footer">
                        <a href="/goals" class="widget-link">View All Goals ‚Üí</a>
                    </div>
                </div>

                <!-- Upcoming Bills Widget -->
                <div class="widget-card">
                    <div class="widget-header">
                        <span class="widget-icon">üìÖ</span>
                        <h3 class="widget-title">Upcoming Bills</h3>
                    </div>
                    <div class="widget-content" id="upcomingBillsContent">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìÖ</div>
                            <div class="empty-state-text">No recurring bills set up</div>
                            <a href="/budget" class="empty-state-cta">Set up recurring bills</a>
                        </div>
                    </div>
                    <div class="widget-footer">
                        <a href="/budget" class="widget-link">Manage Bills ‚Üí</a>
                    </div>
                </div>
            </div>

            <!-- Calculator Modals -->
            <!-- Income Calculator Modal -->
            <div class="modal" id="incomeCalculatorModal">
                <div class="modal-content">
                    <div class="modal-header">
                        üí∞ Income Calculator
                        <button class="modal-close" onclick="closeCalculator('incomeCalculatorModal')">√ó</button>
                    </div>
                    <div class="calculator-body">
                        <div class="form-group">
                            <label>Base Monthly Salary</label>
                            <input type="number" id="incomeBaseSalary" step="0.01" min="0" placeholder="3500">
                        </div>
                        <div class="form-group">
                            <label>Contract Length (months)</label>
                            <input type="number" id="incomeContractLength" min="1" max="24" value="6">
                        </div>
                        <div class="form-group">
                            <label>Overtime Hours per Month</label>
                            <input type="number" id="incomeOvertimeHours" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>Overtime Rate per Hour</label>
                            <input type="number" id="incomeOvertimeRate" step="0.01" min="0" placeholder="25">
                        </div>
                        <div class="form-group">
                            <label>Monthly Tips/Bonuses</label>
                            <input type="number" id="incomeTips" step="0.01" min="0" value="0">
                        </div>
                        <button class="btn btn-primary" onclick="calculateIncome()">Calculate</button>
                        
                        <div id="incomeResults" class="calculator-results" style="display: none;">
                            <div class="result-row">
                                <span>Monthly Total:</span>
                                <strong id="incomeMonthlyTotal">$0.00</strong>
                            </div>
                            <div class="result-row">
                                <span>Contract Total:</span>
                                <strong id="incomeContractTotal">$0.00</strong>
                            </div>
                            <div class="result-row">
                                <span>Daily Rate:</span>
                                <strong id="incomeDailyRate">$0.00</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tax Calculator Modal -->
            <div class="modal" id="taxCalculatorModal">
                <div class="modal-content">
                    <div class="modal-header">
                        üíº Tax Calculator
                        <button class="modal-close" onclick="closeCalculator('taxCalculatorModal')">√ó</button>
                    </div>
                    <div class="calculator-body">
                        <div class="form-group">
                            <label>Annual Income</label>
                            <input type="number" id="taxAnnualIncome" step="0.01" min="0" placeholder="60000">
                        </div>
                        <div class="form-group">
                            <label>Tax Rate (%)</label>
                            <input type="number" id="taxRate" step="0.1" min="0" max="100" placeholder="15">
                        </div>
                        <button class="btn btn-primary" onclick="calculateTax()">Calculate</button>
                        
                        <div id="taxResults" class="calculator-results" style="display: none;">
                            <div class="result-row">
                                <span>Gross Annual:</span>
                                <strong id="taxGrossAnnual">$0.00</strong>
                            </div>
                            <div class="result-row">
                                <span>Income Tax:</span>
                                <strong id="taxAmount" class="text-danger">-$0.00</strong>
                            </div>
                            <div class="result-row">
                                <span>Net Annual:</span>
                                <strong id="taxNetAnnual">$0.00</strong>
                            </div>
                            <div class="result-row">
                                <span>Net Monthly:</span>
                                <strong id="taxNetMonthly">$0.00</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Family Support Calculator Modal -->
            <div class="modal" id="familyCalculatorModal">
                <div class="modal-content">
                    <div class="modal-header">
                        üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Support Calculator
                        <button class="modal-close" onclick="closeCalculator('familyCalculatorModal')">√ó</button>
                    </div>
                    <div class="calculator-body">
                        <div class="form-group">
                            <label>Monthly Income</label>
                            <input type="number" id="familyIncome" step="0.01" min="0" placeholder="5000">
                        </div>
                        <div class="form-group">
                            <label>Number of Family Members</label>
                            <input type="number" id="familyMembers" min="1" value="4">
                        </div>
                        <div class="form-group">
                            <label>Support Percentage (%)</label>
                            <input type="number" id="supportPercentage" step="1" min="0" max="100" placeholder="30">
                        </div>
                        <button class="btn btn-primary" onclick="calculateFamilySupport()">Calculate</button>
                        
                        <div id="familyResults" class="calculator-results" style="display: none;">
                            <div class="result-row">
                                <span>Monthly Income:</span>
                                <strong id="familyMonthlyIncome">$0.00</strong>
                            </div>
                            <div class="result-row">
                                <span>Total Support:</span>
                                <strong id="familyTotalSupport" class="text-warning">$0.00</strong>
                            </div>
                            <div class="result-row">
                                <span>Per Member:</span>
                                <strong id="familyPerMember">$0.00</strong>
                            </div>
                            <div class="result-row">
                                <span>Remaining Income:</span>
                                <strong id="familyRemaining" class="text-success">$0.00</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Savings Calculator Modal -->
            <div class="modal" id="savingsCalculatorModal">
                <div class="modal-content">
                    <div class="modal-header">
                        üè¶ Savings Calculator
                        <button class="modal-close" onclick="closeCalculator('savingsCalculatorModal')">√ó</button>
                    </div>
                    <div class="calculator-body">
                        <div class="form-group">
                            <label>Savings Goal</label>
                            <input type="number" id="savingsGoal" step="0.01" min="0" placeholder="25000">
                        </div>
                        <div class="form-group">
                            <label>Current Savings</label>
                            <input type="number" id="currentSavings" step="0.01" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>Monthly Contribution</label>
                            <input type="number" id="monthlySavings" step="0.01" min="0" placeholder="500">
                        </div>
                        <button class="btn btn-primary" onclick="calculateSavings()">Calculate</button>
                        
                        <div id="savingsResults" class="calculator-results" style="display: none;">
                            <div class="result-row">
                                <span>Amount Needed:</span>
                                <strong id="savingsNeeded">$0.00</strong>
                            </div>
                            <div class="result-row">
                                <span>Months to Goal:</span>
                                <strong id="savingsMonths">0</strong>
                            </div>
                            <div class="result-row">
                                <span>Target Date:</span>
                                <strong id="savingsTargetDate">-</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Investment Calculator Modal -->
            <div class="modal" id="investmentCalculatorModal">
                <div class="modal-content">
                    <div class="modal-header">
                        üìà Investment Calculator
                        <button class="modal-close" onclick="closeCalculator('investmentCalculatorModal')">√ó</button>
                    </div>
                    <div class="calculator-body">
                        <div class="form-group">
                            <label>Initial Investment</label>
                            <input type="number" id="investmentInitial" step="0.01" min="0" placeholder="10000">
                        </div>
                        <div class="form-group">
                            <label>Monthly Contribution</label>
                            <input type="number" id="investmentMonthly" step="0.01" min="0" placeholder="500">
                        </div>
                        <div class="form-group">
                            <label>Expected Annual Return (%)</label>
                            <input type="number" id="investmentReturn" step="0.1" min="-100" max="100" placeholder="7">
                        </div>
                        <div class="form-group">
                            <label>Investment Period (years)</label>
                            <input type="number" id="investmentYears" min="1" max="50" value="10">
                        </div>
                        <button class="btn btn-primary" onclick="calculateInvestment()">Calculate</button>
                        
                        <div id="investmentResults" class="calculator-results" style="display: none;">
                            <div class="result-row">
                                <span>Final Value:</span>
                                <strong id="investmentFinalValue" class="text-success">$0.00</strong>
                            </div>
                            <div class="result-row">
                                <span>Total Invested:</span>
                                <strong id="investmentTotalInvested">$0.00</strong>
                            </div>
                            <div class="result-row">
                                <span>Total Earnings:</span>
                                <strong id="investmentEarnings">$0.00</strong>
                            </div>
                            <div class="result-row">
                                <span>ROI:</span>
                                <strong id="investmentROI">0%</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyBccv9C4CpjZFeE2HGBKKfUiV9jUw8CZLo",
            authDomain: "crewwealth-cbe02.firebaseapp.com",
            projectId: "crewwealth-cbe02",
            storageBucket: "crewwealth-cbe02.firebasestorage.app",
            messagingSenderId: "852834158589",
            appId: "1:852834158589:web:8201ed1d9327841773bb94"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ============================================
        // GLOBAL STATE
        // ============================================
        let currentUser = null;
        let userCurrency = 'EUR'; // global variable for currency

        // ============================================
        // CURRENCY FUNCTIONS
        // ============================================
        function getMonthKey(date = new Date()) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
        }

        function formatCurrency(amount) {
            const currencyConfig = {
                'USD': { symbol: '$', decimals: 2 },
                'EUR': { symbol: '‚Ç¨', decimals: 2 },
                'GBP': { symbol: '¬£', decimals: 2 },
                'PHP': { symbol: '‚Ç±', decimals: 2 },
                'INR': { symbol: '‚Çπ', decimals: 2 },
                'IDR': { symbol: 'Rp', decimals: 0 },
                'SGD': { symbol: 'S$', decimals: 2 },
                'NOK': { symbol: 'kr', decimals: 2 },
                'AUD': { symbol: 'A$', decimals: 2 },
                'CAD': { symbol: 'C$', decimals: 2 },
                'JPY': { symbol: '¬•', decimals: 0 }
            };
            
            const config = currencyConfig[userCurrency] || currencyConfig['EUR'];
            const formatted = (amount || 0).toFixed(config.decimals)
                .replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            
            return config.symbol + formatted;
        }

        function getCurrencySymbol() {
            const symbols = {
                'EUR': '‚Ç¨', 'USD': '$', 'GBP': '¬£', 'PHP': '‚Ç±',
                'INR': '‚Çπ', 'AUD': 'A$', 'CAD': 'C$', 'SGD': 'S$',
                'NOK': 'kr', 'JPY': '¬•'
            };
            return symbols[userCurrency] || '‚Ç¨';
        }

        function updateCurrencyLabels() {
            document.querySelectorAll('.currency-symbol').forEach(el => {
                el.textContent = getCurrencySymbol();
            });
        }

        async function loadUserSettings() {
            if (!currentUser) return;
            
            try {
                const doc = await db.collection('users').doc(currentUser.uid).get();
                if (doc.exists) {
                    userCurrency = doc.data().settings?.currency || 'EUR';
                    updateCurrencyLabels();
                }
            } catch (error) {
                console.error('Error loading user settings:', error);
            }
        }

        // ============================================
        // AUTHENTICATION
        // ============================================
        auth.onAuthStateChanged(async (user) => {
            if (!user) {
                console.log('‚ùå Not authenticated, redirecting to login...');
                window.location.href = '/login';
                return;
            }

            console.log('‚úÖ User authenticated:', user.email);
            currentUser = user;

            // Load user settings first
            await loadUserSettings();

            // Update greeting
            const firstName = user.displayName 
                ? user.displayName.split(' ')[0] 
                : user.email.split('@')[0];
            document.getElementById('heroGreeting').textContent = `Welcome back, ${firstName} üëã`;

            // Calculate and display net worth
            await calculateNetWorth();
            
            // Load dashboard data
            await loadDashboardData();
        });

        // ============================================
        // LOGOUT FUNCTIONALITY
        // ============================================
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                await auth.signOut();
                console.log('‚úÖ Logged out successfully');
                window.location.href = '/login';
            } catch (error) {
                console.error('‚ùå Logout error:', error);
                alert('Failed to logout. Please try again.');
            }
        });

        // ============================================
        // PAGE VISIBILITY HANDLING
        // ============================================
        // Refresh dashboard data when user returns to the page
        // This ensures deleted transactions and updated data are reflected
        let lastRefreshTime = 0;
        const REFRESH_DEBOUNCE_MS = 2000; // Minimum 2 seconds between refreshes
        
        document.addEventListener('visibilitychange', async () => {
            if (!document.hidden && currentUser) {
                const now = Date.now();
                if (now - lastRefreshTime < REFRESH_DEBOUNCE_MS) {
                    console.log('‚è≠Ô∏è Skipping refresh (too soon)');
                    return;
                }
                
                try {
                    console.log('üîÑ Page became visible, refreshing dashboard data...');
                    lastRefreshTime = now;
                    await Promise.all([
                        calculateNetWorth(),
                        loadDashboardData()
                    ]);
                } catch (error) {
                    console.error('‚ùå Error refreshing dashboard data:', error);
                }
            }
        });

        // ============================================
        // DATA LOADING
        // ============================================
        async function calculateNetWorth() {
            if (!currentUser) return;

            try {
                // Load accounts from Firebase
                const accountsSnapshot = await db.collection('users')
                    .doc(currentUser.uid)
                    .collection('accounts')
                    .get();

                let offBudgetTotal = 0; // Savings
                let onBudgetTotal = 0;  // All on-budget money
                
                accountsSnapshot.docs.forEach(doc => {
                    const account = doc.data();
                    const balance = parseFloat(account.balance) || 0;
                    
                    if (account.offBudget) {
                        offBudgetTotal += balance;
                    } else {
                        onBudgetTotal += balance;
                    }
                });

                // Get current month budget to calculate "To Budget" (unassigned money)
                const monthKey = getMonthKey();
                
                const budgetDoc = await db.collection('users')
                    .doc(currentUser.uid)
                    .collection('budgets')
                    .doc(monthKey)
                    .get();

                let totalBudgeted = 0;
                if (budgetDoc.exists) {
                    const budgets = budgetDoc.data();
                    // Sum all budgeted amounts (excluding metadata fields)
                    totalBudgeted = Object.entries(budgets).reduce((sum, [key, val]) => {
                        if (key !== 'createdAt' && key !== 'updatedAt') {
                            return sum + (parseFloat(val) || 0);
                        }
                        return sum;
                    }, 0);
                }

                // To Budget = On Budget Total - Total Budgeted
                const toBudget = onBudgetTotal - totalBudgeted;

                // Net Worth = Off Budget (Savings) + To Budget (Available)
                const netWorth = offBudgetTotal + toBudget;

                // Update UI
                document.getElementById('netWorthAmount').textContent = formatCurrency(netWorth);
                document.getElementById('savingsAmount').textContent = formatCurrency(offBudgetTotal) + ' Savings';
                document.getElementById('toBudgetAmount').textContent = formatCurrency(toBudget) + ' Available';

                console.log('‚úÖ Net worth calculated:', {
                    netWorth,
                    savings: offBudgetTotal,
                    available: toBudget,
                    totalBudgeted
                });

            } catch (error) {
                console.error('‚ùå Error calculating net worth:', error);
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ============================================
        // DASHBOARD WIDGETS
        // ============================================
        async function loadDashboardData() {
            if (!currentUser) return;

            try {
                // Initial load of all widgets
                await Promise.all([
                    loadMonthOverview(),
                    loadRecentTransactions(),
                    loadGoalsProgress(),
                    loadUpcomingBills()
                ]);
                
                // Set up real-time listeners for automatic updates
                setupRealtimeListeners();
                
                console.log('‚úÖ Dashboard widgets loaded');
            } catch (error) {
                console.error('‚ùå Error loading dashboard data:', error);
            }
        }

        // ============================================
        // REAL-TIME LISTENERS
        // ============================================
        function setupRealtimeListeners() {
            if (!currentUser) return;

            // Listen to accounts changes
            db.collection('users').doc(currentUser.uid)
                .collection('accounts')
                .onSnapshot((snapshot) => {
                    console.log('üîÑ Accounts updated in real-time');
                    calculateNetWorth();
                });

            // Listen to budget changes
            const monthKey = getMonthKey();
            
            db.collection('users').doc(currentUser.uid)
                .collection('budgets')
                .doc(monthKey)
                .onSnapshot((doc) => {
                    console.log('üîÑ Budget updated in real-time');
                    calculateNetWorth();
                    loadMonthOverview();
                });

            // Listen to transactions changes
            db.collection('users').doc(currentUser.uid)
                .collection('transactions')
                .onSnapshot((snapshot) => {
                    console.log('üîÑ Transactions updated in real-time');
                    loadRecentTransactions();
                    loadMonthOverview();
                });
        }

        async function loadMonthOverview() {
            if (!currentUser) return;

            try {
                // Get current month's start and end
                const now = new Date();
                const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
                const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59);
                const monthKey = getMonthKey();

                // Get budgets from budgets collection
                const budgetDoc = await db.collection('users')
                    .doc(currentUser.uid)
                    .collection('budgets')
                    .doc(monthKey)
                    .get();

                let totalBudgeted = 0;
                if (budgetDoc.exists) {
                    const budgets = budgetDoc.data();
                    // Sum all budgeted amounts (excluding metadata fields)
                    totalBudgeted = Object.entries(budgets).reduce((sum, [key, val]) => {
                        if (key !== 'createdAt' && key !== 'updatedAt') {
                            return sum + (parseFloat(val) || 0);
                        }
                        return sum;
                    }, 0);
                }

                // Get transactions for current month
                const transactionsSnapshot = await db.collection('users')
                    .doc(currentUser.uid)
                    .collection('transactions')
                    .where('date', '>=', firebase.firestore.Timestamp.fromDate(monthStart))
                    .where('date', '<=', firebase.firestore.Timestamp.fromDate(monthEnd))
                    .get();

                let totalSpent = 0;
                transactionsSnapshot.docs.forEach(doc => {
                    const transaction = doc.data();
                    if (transaction.type === 'expense') {
                        totalSpent += Math.abs(parseFloat(transaction.amount) || 0);
                    }
                });

                // Update UI
                document.getElementById('totalBudgeted').textContent = formatCurrency(totalBudgeted);
                document.getElementById('totalSpent').textContent = formatCurrency(totalSpent);

                // Calculate progress
                const percentage = totalBudgeted > 0 ? (totalSpent / totalBudgeted) * 100 : 0;
                const progressBar = document.getElementById('budgetProgressBar');
                progressBar.style.width = Math.min(percentage, 100) + '%';
                
                if (percentage > 100) {
                    progressBar.classList.add('over-budget');
                } else {
                    progressBar.classList.remove('over-budget');
                }

                document.getElementById('budgetProgressLabel').textContent = 
                    `${percentage.toFixed(1)}% of budget used`;

            } catch (error) {
                console.error('‚ùå Error loading month overview:', error);
            }
        }

        async function loadRecentTransactions() {
            if (!currentUser) return;

            try {
                const transactionsSnapshot = await db.collection('users')
                    .doc(currentUser.uid)
                    .collection('transactions')
                    .orderBy('date', 'desc')
                    .limit(7)
                    .get();

                const container = document.getElementById('recentTransactionsContent');
                
                if (transactionsSnapshot.empty) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìù</div>
                            <div class="empty-state-text">No transactions yet</div>
                        </div>
                    `;
                    return;
                }

                let html = '';
                transactionsSnapshot.docs.forEach(doc => {
                    const transaction = doc.data();
                    const amount = parseFloat(transaction.amount) || 0;
                    const date = transaction.date ? transaction.date.toDate() : new Date();
                    const relativeDate = getRelativeDate(date);
                    const amountClass = transaction.type === 'income' ? 'income' : 'expense';
                    const amountFormatted = transaction.type === 'income' 
                        ? '+' + formatCurrency(Math.abs(amount))
                        : '-' + formatCurrency(Math.abs(amount));

                    html += `
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div class="transaction-name">${escapeHtml(transaction.description || 'Transaction')}</div>
                                <div class="transaction-meta">
                                    <span>${escapeHtml(transaction.category || 'Uncategorized')}</span>
                                    <span>‚Ä¢</span>
                                    <span>${relativeDate}</span>
                                </div>
                            </div>
                            <div class="transaction-amount ${amountClass}">${amountFormatted}</div>
                        </div>
                    `;
                });

                container.innerHTML = html;

            } catch (error) {
                console.error('‚ùå Error loading recent transactions:', error);
            }
        }

        async function loadGoalsProgress() {
            if (!currentUser) return;

            try {
                const goalsSnapshot = await db.collection('users')
                    .doc(currentUser.uid)
                    .collection('goals')
                    .where('status', '==', 'active')
                    .orderBy('targetDate', 'asc')
                    .limit(3)
                    .get();

                const container = document.getElementById('goalsProgressContent');
                
                if (goalsSnapshot.empty) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üéØ</div>
                            <div class="empty-state-text">No active goals</div>
                            <a href="/goals" class="empty-state-cta">Create your first goal</a>
                        </div>
                    `;
                    return;
                }

                let html = '';
                goalsSnapshot.docs.forEach(doc => {
                    const goal = doc.data();
                    const target = parseFloat(goal.targetAmount) || 0;
                    const current = parseFloat(goal.currentAmount) || 0;
                    const percentage = target > 0 ? (current / target) * 100 : 0;
                    const icon = goal.icon || 'üéØ';

                    html += `
                        <div class="goal-item">
                            <div class="goal-header">
                                <div class="goal-name">${icon} ${escapeHtml(goal.name || 'Goal')}</div>
                                <div class="goal-percentage">${percentage.toFixed(0)}%</div>
                            </div>
                            <div class="goal-amounts">${formatCurrency(current)} / ${formatCurrency(target)}</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(percentage, 100)}%"></div>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;

            } catch (error) {
                console.error('‚ùå Error loading goals progress:', error);
            }
        }

        async function loadUpcomingBills() {
            if (!currentUser) return;

            try {
                const billsSnapshot = await db.collection('users')
                    .doc(currentUser.uid)
                    .collection('recurringTransactions')
                    .where('isActive', '==', true)
                    .get();

                const container = document.getElementById('upcomingBillsContent');
                
                if (billsSnapshot.empty) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìÖ</div>
                            <div class="empty-state-text">No recurring bills set up</div>
                            <a href="/budget" class="empty-state-cta">Set up recurring bills</a>
                        </div>
                    `;
                    return;
                }

                // Filter and sort bills due within 14 days
                const now = new Date();
                const fourteenDaysFromNow = new Date(now.getTime() + 14 * 24 * 60 * 60 * 1000);
                
                const upcomingBills = billsSnapshot.docs
                    .map(doc => {
                        const bill = doc.data();
                        const nextDueDate = bill.nextDueDate ? bill.nextDueDate.toDate() : null;
                        return { id: doc.id, ...bill, nextDueDate };
                    })
                    .filter(bill => bill.nextDueDate && bill.nextDueDate <= fourteenDaysFromNow)
                    .sort((a, b) => a.nextDueDate - b.nextDueDate);

                if (upcomingBills.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">‚úÖ</div>
                            <div class="empty-state-text">No bills due in the next 14 days</div>
                        </div>
                    `;
                    return;
                }

                let html = '';
                upcomingBills.forEach(bill => {
                    const daysUntilDue = Math.ceil((bill.nextDueDate - now) / (1000 * 60 * 60 * 24));
                    let dueText = '';
                    let dueClass = '';
                    
                    if (daysUntilDue < 0) {
                        dueText = 'Overdue';
                        dueClass = 'overdue';
                    } else if (daysUntilDue === 0) {
                        dueText = 'Due today';
                        dueClass = 'overdue';
                    } else if (daysUntilDue <= 7) {
                        dueText = `Due in ${daysUntilDue} day${daysUntilDue > 1 ? 's' : ''}`;
                        dueClass = 'upcoming';
                    } else {
                        dueText = `Due ${bill.nextDueDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`;
                        dueClass = '';
                    }

                    html += `
                        <div class="bill-item">
                            <div class="bill-info">
                                <div class="bill-name">${escapeHtml(bill.name || 'Bill')}</div>
                                <div class="bill-due ${dueClass}">${dueText}</div>
                            </div>
                            <div class="bill-amount">${formatCurrency(Math.abs(bill.amount || 0))}</div>
                        </div>
                    `;
                });

                container.innerHTML = html;

            } catch (error) {
                console.error('‚ùå Error loading upcoming bills:', error);
            }
        }

        function getRelativeDate(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
            
            // Calculate actual month difference
            const monthsDiff = (now.getFullYear() - date.getFullYear()) * 12 + (now.getMonth() - date.getMonth());
            if (monthsDiff > 0 && monthsDiff < 12) return `${monthsDiff} month${monthsDiff > 1 ? 's' : ''} ago`;
            
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        // ============================================
        // CALCULATOR MODAL CONTROLS
        // ============================================
        function openIncomeCalculator() {
            document.getElementById('incomeCalculatorModal').classList.add('active');
        }

        function openTaxCalculator() {
            document.getElementById('taxCalculatorModal').classList.add('active');
        }

        function openFamilyCalculator() {
            document.getElementById('familyCalculatorModal').classList.add('active');
        }

        function openSavingsCalculator() {
            document.getElementById('savingsCalculatorModal').classList.add('active');
        }

        function openInvestmentCalculator() {
            document.getElementById('investmentCalculatorModal').classList.add('active');
        }

        function closeCalculator(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // ============================================
        // CALCULATOR LOGIC
        // ============================================
        function calculateIncome() {
            const baseSalary = parseFloat(document.getElementById('incomeBaseSalary').value) || 0;
            const contractLength = parseInt(document.getElementById('incomeContractLength').value) || 1;
            const overtimeHours = parseFloat(document.getElementById('incomeOvertimeHours').value) || 0;
            const overtimeRate = parseFloat(document.getElementById('incomeOvertimeRate').value) || 0;
            const tips = parseFloat(document.getElementById('incomeTips').value) || 0;

            // Calculate
            const overtimeTotal = overtimeHours * overtimeRate;
            const monthlyTotal = baseSalary + overtimeTotal + tips;
            const contractTotal = monthlyTotal * contractLength;
            const dailyRate = monthlyTotal / 30;

            // Display
            document.getElementById('incomeMonthlyTotal').textContent = formatCurrency(monthlyTotal);
            document.getElementById('incomeContractTotal').textContent = formatCurrency(contractTotal);
            document.getElementById('incomeDailyRate').textContent = formatCurrency(dailyRate);
            document.getElementById('incomeResults').style.display = 'block';
        }

        function calculateTax() {
            const annualIncome = parseFloat(document.getElementById('taxAnnualIncome').value) || 0;
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;

            const taxAmount = annualIncome * (taxRate / 100);
            const netAnnual = annualIncome - taxAmount;
            const netMonthly = netAnnual / 12;

            document.getElementById('taxGrossAnnual').textContent = formatCurrency(annualIncome);
            document.getElementById('taxAmount').textContent = '-' + formatCurrency(taxAmount);
            document.getElementById('taxNetAnnual').textContent = formatCurrency(netAnnual);
            document.getElementById('taxNetMonthly').textContent = formatCurrency(netMonthly);
            document.getElementById('taxResults').style.display = 'block';
        }

        function calculateFamilySupport() {
            const income = parseFloat(document.getElementById('familyIncome').value) || 0;
            const members = parseInt(document.getElementById('familyMembers').value) || 1;
            const percentage = parseFloat(document.getElementById('supportPercentage').value) || 0;

            const totalSupport = income * (percentage / 100);
            const perMember = totalSupport / members;
            const remaining = income - totalSupport;

            document.getElementById('familyMonthlyIncome').textContent = formatCurrency(income);
            document.getElementById('familyTotalSupport').textContent = formatCurrency(totalSupport);
            document.getElementById('familyPerMember').textContent = formatCurrency(perMember);
            document.getElementById('familyRemaining').textContent = formatCurrency(remaining);
            document.getElementById('familyResults').style.display = 'block';
        }

        function calculateSavings() {
            const goal = parseFloat(document.getElementById('savingsGoal').value) || 0;
            const current = parseFloat(document.getElementById('currentSavings').value) || 0;
            const monthly = parseFloat(document.getElementById('monthlySavings').value) || 0;

            const needed = goal - current;
            
            let months = 0;
            let targetDateText = '-';
            
            if (needed <= 0) {
                months = 0;
                targetDateText = 'Goal already achieved! üéâ';
            } else if (monthly <= 0) {
                months = Infinity;
                targetDateText = 'Never at this rate';
            } else {
                months = Math.ceil(needed / monthly);
                const targetDate = new Date();
                targetDate.setMonth(targetDate.getMonth() + months);
                targetDateText = targetDate.toLocaleDateString('en-US', {
                    month: 'long',
                    year: 'numeric'
                });
            }

            document.getElementById('savingsNeeded').textContent = formatCurrency(Math.max(0, needed));
            document.getElementById('savingsMonths').textContent = 
                months === Infinity ? '‚àû' : months + ' months';
            document.getElementById('savingsTargetDate').textContent = targetDateText;
            document.getElementById('savingsResults').style.display = 'block';
        }

        function calculateInvestment() {
            const initial = parseFloat(document.getElementById('investmentInitial').value) || 0;
            const monthly = parseFloat(document.getElementById('investmentMonthly').value) || 0;
            const annualReturn = parseFloat(document.getElementById('investmentReturn').value) || 0;
            const years = parseInt(document.getElementById('investmentYears').value) || 1;

            // Convert to monthly rate
            const monthlyRate = annualReturn / 12 / 100;
            const months = years * 12;

            let finalValue = 0;

            if (monthlyRate === 0) {
                // Simple addition if no return
                finalValue = initial + (monthly * months);
            } else {
                // Compound interest: FV = P(1+r)^n + PMT √ó [((1+r)^n - 1) / r]
                const initialGrowth = initial * Math.pow(1 + monthlyRate, months);
                const contributionsGrowth = monthly * ((Math.pow(1 + monthlyRate, months) - 1) / monthlyRate);
                finalValue = initialGrowth + contributionsGrowth;
            }

            const totalInvested = initial + (monthly * months);
            const earnings = finalValue - totalInvested;
            const roi = totalInvested > 0 ? (earnings / totalInvested) * 100 : 0;

            document.getElementById('investmentFinalValue').textContent = formatCurrency(finalValue);
            document.getElementById('investmentTotalInvested').textContent = formatCurrency(totalInvested);
            document.getElementById('investmentEarnings').textContent = formatCurrency(earnings);
            document.getElementById('investmentROI').textContent = roi.toFixed(1) + '%';
            document.getElementById('investmentResults').style.display = 'block';
        }
    </script>
</body>
</html>